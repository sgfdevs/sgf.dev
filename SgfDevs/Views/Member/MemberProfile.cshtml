@model Umbraco.Cms.Web.Common.PublishedModels.Member
@using Tag = Umbraco.Cms.Web.Common.PublishedModels.Tag;

@{
    var name = Model.FirstName + " " + Model.LastName;
    var image = Model.ProfileImage != null ? Model.ProfileImage.GetCropUrl(width: 800) : "/images/pipey.jpg";
    var memberTags = Model.HasValue("MemberTags") ? Model.MemberTags?.Cast<Tag>().ToList() ?? [] : [];
    var joinDate = (Model.GetProperty("CreateDate")?.GetValue() as DateTime?)?.ToString("MMMM yyyy");
    string url = null;
    string urlDisplay = null;
    if (Model.HasValue("WebsiteUrl") && !string.IsNullOrWhiteSpace(Model.WebsiteUrl))
    {
        url = Model.WebsiteUrl.StartsWith("http") ? Model.WebsiteUrl : $"https://{Model.WebsiteUrl}";
        urlDisplay = Model.WebsiteUrl
            .ReplaceFirst("http://", "")
            .ReplaceFirst("https://", "")
            .ReplaceFirst("www.", "")
            .ToLower()
            .Split("/")[0];
    }
}


<main class="profile">

    <header class="profile-header">
        <div class="information">
            <h1>@name</h1>
            <h2>@Model.JobTitle</h2>

            @if (url != null)
            {
                <a href="@url" target="_blank" class="button">Visit Site</a>
            }

            @if (Model.AvailableForContractWork || Model.AvailableForHire)
            {
                <a href="#" class="button outline">Hire Me</a>
            }
        </div>

        <div class="image-wrapper">
            <div class="image">
                <figure>
                    <img src="@image" alt="@name"/>
                </figure>
                <figcaption>
                    @foreach (var tagName in memberTags.Select(tag => !string.IsNullOrWhiteSpace(tag.DisplayName) ? tag.DisplayName : tag.Name))
                    {
                        <div>@tagName</div>
                    }
                </figcaption>
            </div>
        </div>
    </header>

    <section class="profile-content tabs">
        <input name="tabs" type="radio" id="tab-1" checked="checked" class="tab" />
        <label for="tab-1" class="label">About</label>
        <div class="panel about">
            <div class="col-1">
                <div class="metadata">
                    <div class="location">
                        <i class="icon fas fa-map-marker-alt"></i>
                        @Model.City, @Model.State
                    </div>

                    @if (!string.IsNullOrEmpty(joinDate))
                    {
                        <div class="member-since">
                            <i class="icon fas fa-calendar-alt"></i>
                            Member since @joinDate
                        </div>
                    }
                </div>

                <div class="socials">
                    <h3>Social</h3>

                    <ul>
                        @if (url != null)
                        {
                            <li class="social website">
                                <a href="@url" target="_blank"><i class="icon fa fa-globe"></i> @urlDisplay</a>
                            </li>
                        }

                        @if (Model.HasValue("TwitterUrl"))
                        {
                            <li class="social twitter">
                                <a href="@Model.TwitterUrl" target="_blank"><i class="icon fab fa-twitter"></i> Twitter</a>
                            </li>
                        }

                        @if (Model.HasValue("LinkedInUrl"))
                        {
                            <li class="social linkedin">
                                <a href="@Model.LinkedInUrl" target="_blank"><i class="icon fab fa-linkedin"></i> LinkedIn</a>
                            </li>
                        }

                        @if (Model.HasValue("FacebookUrl"))
                        {
                            <li class="social facebook">
                                <a href="@Model.FacebookUrl" target="_blank"><i class="icon fab fa-facebook"></i> Facebook</a>
                            </li>
                        }

                        @if (Model.HasValue("InstagramUrl"))
                        {
                            <li class="social instagram">
                                <a href="@Model.InstagramUrl" target="_blank"><i class="icon fab fa-instagram"></i> Instagram</a>
                            </li>
                        }

                        @if (Model.HasValue("YouTubeUrl"))
                        {
                            <li class="social youtube">
                                <a href="@Model.YouTubeUrl" target="_blank"><i class="icon fab fa-youtube"></i> Youtube</a>
                            </li>
                        }
                    </ul>
                </div>
            </div>

            <div class="col-2">
                <div class="bio">
                    <h3>Biography</h3>
                    @Html.Raw(Model.AboutText)
                </div>

                @if (Model.HasValue("SkillsTags"))
                {
                    <div class="skills">
                        <h3>Skills</h3>

                        <div class="skill-list">
                            @foreach (Tag skill in Model.SkillsTags)
                            {
                                var skillName = string.IsNullOrEmpty(skill.DisplayName) ? skill.Name : skill.DisplayName;
                                <a href="/directory/?skill=@skill.UrlSegment" class="button outline skill">@skillName @*<span class="count">(0)</span>*@</a>

                                // Directory does not yet support any querystrings params but just plugging
                                // something here for the heck of it. - Myke
                            }
                        </div>
                    </div>
                }
            </div>
        </div>

        <input name="tabs" type="radio" id="tab-2" class="tab" />
        <label for="tab-2" class="label">Archive <span>0</span></label>
        <div class="panel archive">
            <h3>Archive</h3>
            <p>
                Member video archive feature is coming soon
            </p>
        </div>

    </section>
</main>
